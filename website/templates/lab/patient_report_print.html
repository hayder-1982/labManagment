

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تقرير نتائج التحاليل الطبية - {{ patient.full_name }}</title>
<style>
body {
    font-family: "Times New Roman", Times, serif;
    direction: rtl;
    color: #000;
    background: #fff;
    margin: 0;
    padding: 0;
    font-size: 13px;
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
}
table {
    width: 100%;
    border-collapse: collapse;
}

th, td {
    padding: 6px;
    text-align: center;
    font-size: 13px;
    border: none; /* بدون حدود */
}
th, td {
    padding: 6px;
    text-align: center;
    border: none; /* لا حدود للخلايا */
}

tr {
    border-bottom: 1px dashed #555; /* خط مقطع */
}

thead tr {
    border-bottom: 2px solid #000; /* خط ثابت للهيدر */
}

tfoot tr {
    border-top: 2px solid #000; /* خط ثابت للفوتر */
}

/* تأثير hover */
tbody tr:hover {
    background-color: #f5f5f5; /* خلفية خفيفة عند المرور */
    cursor: pointer;
}
/* عنوان المجموعة */
.group-header span{
    font-family: "Bradley Hand ITC", Times, serif;
    font-size: 16px;
    font-weight: bold;
                 /* محاذاة لليسار */
    background-color: #d9d9d9;     /* خلفية رصاصي */
    color: #000;                   /* نص أسود */
    padding: 6px;                  /* مسافة داخلية */
    -webkit-print-color-adjust: exact; /* الحفاظ على اللون عند الطباعة */
}


/* الهيدر */
.print-header {
    text-align: center;
    padding: 5px;
    border-bottom: 1px solid #000;
}
.print-header .logo {
    font-size: 18px;
    font-weight: 700;
    color: #000;
}
.print-header .lab-info {
    font-size: 11px;
    color: #000;
}
.print-header .report-title {
    font-size: 14px;
    font-weight: bold;
    color: #000;
}

/* بيانات المريض */
.patient-info {
    font-size: 11px;
    border: 1px solid #000;
    padding: 5px;
    margin-top: 5px;
}
.patient-info .info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3px;
}
.info-item { display: flex; gap: 4px; }

/* الفوتر */
.print-footer {
    text-align: center;
    font-size: 11px;
    color: #000;
    border-top: 1px solid #000;
    padding-top: 3px;
    margin-top: 10px;
}
.signature-section {
    display: flex;
    justify-content: space-around;
    margin-top: 5px;
}
.signature-box {
    text-align: center;
    border: 1px solid #000;
    padding: 4px;
    font-size: 10px;
    width: 40%;
}
.signature-title {
    font-weight: bold;
}
.signature-line {
    border-top: 1px solid #000;
    margin-top: 10px;
    font-size: 9px;
    padding-top: 2px;
}
.container {
    max-width: 210mm;
    margin: 0 auto;
    padding: 10px;
    background: white;
}





/* الطباعة */
@media print {
    @page {
        size: A4;
        margin: 2cm 1.5cm;
    }
    thead { display: table-header-group; }
    tfoot { display: table-footer-group; }

    /* منع تقسيم المجموعات */
    .group-block { page-break-inside: avoid; break-inside: avoid; }

    /* ألوان الحالات تتحول لدرجات رمادي للطباعة */
    .status-normal { font-weight: bold; }
    .status-high { font-weight: bold; text-decoration: underline; }
    .status-low { font-weight: bold; font-style: italic; }
}
/* تأثير hover على صفوف النتائج */
</style>
<style>
/* تأثير striped للصفوف (باستثناء group-header) */
.table-striped tbody tr:not(.group-header):nth-of-type(odd) {
    background-color: #f9f9f9; /* لون فاتح للصفوف الفردية */
}

/* تأثير hover للصفوف (باستثناء group-header) */
.table-striped tbody tr:not(.group-header):hover {
    background-color: #f0f8ff; /* لون عند المرور بالماوس */
    cursor: pointer;
}
</style>

</head>
<body>
<div class="container">

<table class="table table-striped">
    <thead>
        <tr>
            <th colspan="6">
                <div class="print-header">
                    <div class="logo">🏥 مختبر الحكيم التحاليل الطبية</div>
                    <div class="lab-info">العنوان: كربلاء - الملحق | الهاتف: 0096477- | البريد الإلكتروني: haderf@gmail.com</div>
                    <div class="report-title">تقرير نتائج التحاليل الطبية</div>
                </div>
                <div class="patient-info">
                    <div class="info-grid">
                        <div class="info-item"><span>اسم المريض:</span> <span>{{ patient.full_name }}</span></div>
                        <div class="info-item"><span>العمر:</span> <span>{{ patient.age }} سنة</span></div>
                        <div class="info-item"><span>الجنس:</span> <span>{{ patient.get_gender_display }}</span></div>
                        <div class="info-item"><span>الباركود:</span> <span>{{ patient.barcode }}</span></div>
                        <div class="info-item"><span>رقم الهاتف:</span> <span>{{ patient.phone_number }}</span></div>
                        <div class="info-item"><span>تاريخ التقرير:</span> <span>{{ report_date|date:"Y/m/d H:i" }}</span></div>
                    </div>
                </div>
            </th>
        </tr>
        <tr style="border-bottom:1px solid #000;">
            <th dir="ltr" style="text-align: left;">المعدل الطبيعي</th>
            <th dir="ltr" style="text-align: left;">الوحدة</th>
            <th dir="ltr" style="text-align: left;">الحالة</th>
            <th dir="ltr" style="text-align: left;">النتيجة</th>
            <th dir="ltr" style="text-align: left;">اسم التحليل</th>
        </tr>
    </thead>

    {% for group_name, results in results_by_group.items %}
    <tbody class="group-block">
        <tr class="group-header">
            <td style=" text-align: left;" colspan="6"> <span>{{ group_name }}</span></td>
        </tr>
        {% for result in results %}
        <tr>
            <td dir="ltr" style="text-align: left;" >{{ result.normal_range|linebreaksbr }}</td>
            <td dir="ltr" style="text-align: left;">{{ result.unit }}</td>
            <td dir="ltr" style="text-align: left;">
                {% if result.status == 'normal' %}

                {% elif result.status == 'high' %}
                    <span style="color: rgb(17, 17, 17);">&#9650;</span>
                {% elif result.status == 'low' %}
                    <span style="color: rgb(9, 9, 9);">&#9660;</span>
                {% endif %}
            </td>
            <td  dir="ltr" style="text-align: left;">
                <strong>{{ result.result_value }}</strong>
            </td>
            <td  dir="ltr" style="text-align: left;">{{ result.test_name }}</td>
        </tr>
        {% endfor %}
    </tbody>
    {% endfor %}

    <tfoot>
        <tr>
            <td colspan="6">
                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-title">توقيع الطبيب المختص</div>
                        <div class="signature-line">التوقيع والختم</div>
                    </div>
                    <div class="signature-box">
                        <div class="signature-title">توقيع مدير المختبر</div>
                        <div class="signature-line">التوقيع والختم</div>
                    </div>
                </div>
                <div class="print-footer">
                     تم الإنشاء بتاريخ: {{ report_date|date:"Y/m/d H:i" }}
                </div>
            </td>
        </tr>
    </tfoot>
</table>

</div>
</body>
</html>