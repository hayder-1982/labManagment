<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ØªÙ‚Ø±ÙŠØ± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠØ© - {{ patient.full_name }}</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');

body {
    font-family: 'Cairo', Arial, sans-serif;
    direction: ltr;
    color: #333;
    background: #fff;
    margin: 0;
    padding: 0;
}

table {
    width: 100%;
    border-collapse: collapse;
    border: 1px solid #dee2e6;
}

th, td {
    border: 1px solid #dee2e6;
    padding: 6px;
    text-align: left;
    font-size: 13px;
}

/* Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© */
.group-header {
    background: linear-gradient(135deg, #2c5aa0, #1e3d72);
    color: white;
    font-weight: bold;
    padding: 8px;
    text-align: right;
    -webkit-print-color-adjust: exact;
}

/* Ø§Ù„Ù‡ÙŠØ¯Ø± */
.print-header {
    text-align: center;
    padding: 5px;
    border-bottom: 2px solid #2c5aa0;
}
.print-header .logo {
    font-size: 20px;
    font-weight: 700;
    color: #2c5aa0;
}
.print-header .lab-info {
    font-size: 12px;
    color: #666;
}
.print-header .report-title {
    font-size: 14px;
    font-weight: bold;
    color: #2c5aa0;
}

/* Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ */
.patient-info {
    font-size: 11px;
    border: 1px solid #dee2e6;
    border-radius: 5px;
    padding: 5px;
    margin-top: 5px;
}
.patient-info .info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4px;
}
.info-item { display: flex;  direction: rtl; }

/* Ø§Ù„ÙÙˆØªØ± */
.print-footer {
    text-align: center;
    font-size: 11px;
    color: #666;
    border-top: 2px solid #2c5aa0;
    padding-top: 3px;
}
.signature-section {
    display: flex;
    justify-content: space-around;
    margin-top: 5px;
}
.signature-box {
    text-align: center;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 4px;
    font-size: 10px;
}
.signature-title {
    font-weight: bold;
    color: #2c5aa0;
}
.signature-line {
    border-top: 1px solid #333;
    margin-top: 10px;
    font-size: 9px;
    padding-top: 2px;
}
.container {
            max-width: 210mm;
            margin: 0 auto;
            padding: 20px;
            background: white;
        }

/* Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
@media print {
    @page {
        size: A4;
        margin: 2cm 1.5cm;
    }
    thead { display: table-header-group; }
    tfoot { display: table-footer-group; }

    /* Ù…Ù†Ø¹ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª */
    .group-block { page-break-inside: avoid; break-inside: avoid; }

    /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„Ø§Øª */
    .status-normal { background: #28a745 !important; color: white !important; -webkit-print-color-adjust: exact; }
    .status-high { background: #dc3545 !important; color: white !important; -webkit-print-color-adjust: exact; }
    .status-low { background: #ffc107 !important; color: #212529 !important; -webkit-print-color-adjust: exact; }
}
</style>
</head>
<body>
<div class="container">

<table>
    <thead>
        <tr>
            <th colspan="6">
                <div class="print-header">
                    <div class="logo">ğŸ¥ Ù…Ø®ØªØ¨Ø± Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠØ©</div>
                    <div class="lab-info">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯ØŒ Ø§Ù„Ø±ÙŠØ§Ø¶ | Ø§Ù„Ù‡Ø§ØªÙ: 011-1234567 | Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: info@medlab.com</div>
                    <div class="report-title">ØªÙ‚Ø±ÙŠØ± Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠØ©</div>
                </div>
                <div class="patient-info">
                 <div class="info-grid">
                        <div class="info-item"><span>Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶:</span> <span>{{ patient.full_name }}</span></div>
                        <div class="info-item"><span>Ø§Ù„Ø¹Ù…Ø±:</span> <span>{{ patient.age }} Ø³Ù†Ø©</span></div>
                        <div class="info-item"><span>Ø§Ù„Ø¬Ù†Ø³:</span> <span>{{ patient.get_gender_display }}</span></div>
                        <div class="info-item"><span>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©:</span> <span>{{ patient.national_id }}</span></div>
                        <div class="info-item"><span>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span> <span>{{ patient.phone_number }}</span></div>
                        <div class="info-item"><span>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</span> <span>{{ report_date|date:"Y/m/d H:i" }}</span></div>
                    </div>
                </div>
            </th>
        </tr>
        <tr>
            <th>Ø§Ø³Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„</th>
            <th>Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
            <th>Ø§Ù„ÙˆØ­Ø¯Ø©</th>
            <th>Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†ØªÙŠØ¬Ø©</th>
        </tr>
    </thead>

    {% for group_name, results in results_by_group.items %}
    <tbody class="group-block">
        <tr class="group-header">
            <td colspan="6">ğŸ“‹ {{ group_name }}</td>
        </tr>
        {% for result in results %}
        <tr>
            <td>{{ result.test_name }}</td>
            <td><strong>{{ result.result_value }}</strong></td>
            <td>{{ result.unit }}</td>
            <td>{{ result.normal_range }}</td>
            <td>
                {% if result.status == 'normal' %}
                    <span class="status-normal">Ø·Ø¨ÙŠØ¹ÙŠ</span>
                {% elif result.status == 'high' %}
                    <span class="status-high">Ù…Ø±ØªÙØ¹</span>
                {% elif result.status == 'low' %}
                    <span class="status-low">Ù…Ù†Ø®ÙØ¶</span>
                {% endif %}
            </td>
            <td>{{ result.result_date|date:"Y/m/d" }}</td>
        </tr>
        {% endfor %}
    </tbody>
    {% endfor %}

    <tfoot>
        <tr>
            <td colspan="6">
                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-title">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø·Ø¨ÙŠØ¨ Ø§Ù„Ù…Ø®ØªØµ</div>
                        <div class="signature-line">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ§Ù„Ø®ØªÙ…</div>
                    </div>
                    <div class="signature-box">
                        <div class="signature-title">ØªÙˆÙ‚ÙŠØ¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø®ØªØ¨Ø±</div>
                        <div class="signature-line">Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆØ§Ù„Ø®ØªÙ…</div>
                    </div>
                </div>
                <div class="print-footer">
                    Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ØµØ§Ø¯Ø± Ù…Ù† Ù…Ø®ØªØ¨Ø± Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ø·Ø¨ÙŠØ© ÙˆÙ…Ø¹ØªÙ…Ø¯ Ù…Ù† ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø© â€” ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¨ØªØ§Ø±ÙŠØ®: {{ report_date|date:"Y/m/d H:i" }}
                </div>
            </td>
        </tr>
    </tfoot>
</table>
</div>
</body>
</html>
